<!--変数を新たに設定（コードを楽にするため）-->
<% goshuin = models.last %>

<% places = Place.includes(:category) %>

<%= target_gosyuin = goshuin.place_id ? places.where('place.id': goshuin.place_id).map{|o| [o.category, o.id] } : [] %>

<!--バリデーションの部分テンプレート-->
<!--formからmodelobjectを抜き出す-->
<%= render "layouts/error_messages", model: f.object %>

<h1>御朱印投稿</h1>
  <%= form_with model: @goshuin do |f| %>
    <div class="form-group">
      <!--画像サイズのブートストラップ-->
      <div class="w-50">
        <% if goshuin.image.attached? %>
          <%= image_tag goshuin.image, style: "max-width: 200px;", id: 'imagePreview', class: "img-fluid mb-3" %>
        <% else %>
          <%= image_tag "gosyuin_no_image", id: 'imagePreview', class: "img-fluid mb-3" %>
        <% end %>
      </div>
      <%= f.file_field :image, id: "imageField" %>

      <%= f.hidden_field :user_id, value: current_user.id %>

      <%= f.collection_radio_buttons :category, Place.categories_i18n, :first, :last do |b| %>
        <%= b.label(class: "mr-2") { b.radio_button(class: "mr-1") + b.text } %>
      <% end %>

      <div class="form-group" id="zinzya"><!-- JavaScriptで能動的なセレクトボックスを作成する為にID設定 -->
        <%= f.label :place, "寺社名<font color='red'>*必須</font>".html_safe %>
        <%= f.select :place_id, @jinja.map { |place| [place.name, place.id] }, { prompt: "選択してください" }, { class: "form-control" } %>
      </div>

      <div class="form-group" id="otera"><!-- JavaScriptで能動的なセレクトボックスを作成する為にID設定 -->
        <%= f.label :place, "寺社名<font color='red'>*必須</font>".html_safe %>
        <%= f.select :place_id, @otera.map { |place| [place.name, place.id] }, { prompt: "選択してください" }, { class: "form-control" } %>
      </div>

      <div class="form-group">
        <%= f.label :参拝日 %>
        <%= f.date_field :visit_day, class: "form-control" %>
      </div>

      <div class="form-group">
        <%= f.label :心付け %>
        <%= f.text_field :price, placeholder: "心付け", class: "form-control" %>
      </div>

      <div class="form-group">
        <%= f.label :めっせぇじ %>
        <%= f.text_area :message, placeholder: "ご自由にどうぞ", class: "form-control" %>
      </div>

      <!--送信フォームここで名前はつけられていないので、表示したいViewの部分テンプレート呼び出し後に記述する-->
      <%= f.submit :投稿, class: "btn btn-primary" %>
    </div>
  <% end %>
